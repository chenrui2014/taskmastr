!function(){"use strict";angular.module("taskmastrApp",["ngTouch","ngAnimate","ng-sortable","taskmastrControllers","taskmastrDirectives"])}();
!function(){"use strict";var o=angular.module("taskmastrControllers",[]);o.controller("UserController",["$http","$scope","$log",function(o,t,e){t.newTodo="",t.user={},t.user.todos=null,t.user.darkmode=null,t.saveButton=!1,t.sortableOptions={handle:".sort",sort:!0,animation:150,ghostClass:"ghost",scroll:!0,scrollSensitivity:30,scrollSpeed:10};var s=0;t.lookup=function(s){o.post("/users/login",{key:s}).success(function(o){t.user.todos=o.todos?o.todos:[],o.hasOwnProperty("key")&&(t.user.key=o.key),t.user.darkmode=o.hasOwnProperty("darkmode")?o.darkmode:!1,e.log("User profile mounted..."),e.log(t.user)}).error(function(){e.log("Error connecting to db!")})},t.create=function(o){t.user.todos.unshift({item:o,complete:!1}),e.log("Creating todo... OK")},t.write=function(s){var r=new Date;t.user.dateModified=r.toISOString(),e.log("Saving to db..."),e.log(t.user),t.saveButton=!1,e.log("saveButton = "+t.saveButton),o.post("/users/write",{json:angular.toJson(t.user)}).success(function(o){e.log("Writing data... OK")}).error(function(o){e.log("Error writing data!")})},t["delete"]=function(o){t.user.todos.splice(o,1)},t.$watch("user.todos",function(o,r){o!==r&&(s>=2&&(t.saveButton=!0),e.log("saveButton = "+t.saveButton),s+=1,console.log("todo counter = "+s))},!0),t.$watch("user.darkmode",function(o,r){o!==r&&(s>=2&&(t.saveButton=!0),e.log("saveButton = "+t.saveButton),s+=1,console.log("darkmode counter = "+s))},!0)}])}();
!function(){var t,e=angular.module("taskmastrDirectives",[]),n=function(){var t=$(window).width();768>t&&($("table tbody td.utils").velocity("fadeOut",{duration:100}),$("table tbody td.toggle").velocity("fadeIn",{delay:100,display:"table-cell",duration:100}))},i=function(t,e){var n,i=e.parents(".todo"),o=i.find("td.todo-cell span").text(),c=t.user.todos;return _.each(c,function(t,e){return t.item===o?(n=e,!1):void 0}),n};e.directive("complete",function(){return{restrict:"A",scope:!1,link:function(t,e,n){e.bind("click",function(){t.$apply(function(){var n=t.user.todos,o=i(t,e),c=n.length,r=n.splice(o,1);_.each(n,function(t,e){return t.complete===!0?(c=e,!1):void 0}),n.splice(c,0,r[0])})})}}}),e.directive("save",function(){return{restrict:"A",scope:!1,link:function(t,e,i){e.bind("click",function(){t.write(t.user.key),n(),e.removeClass("toggled")})}}}),e.directive("checkButton",function(){return{restrict:"A",scope:!1,link:function(t,e,n){e.bind("click",function(){e.siblings(".check").click()})}}}),e.directive("mobileButton",function(){return{restrict:"A",scope:!1,link:function(t,e,n){e.bind("click",function(){$("table tbody td.toggle").velocity("fadeOut",{duration:100}),$("table tbody td.utils").velocity("fadeIn",{delay:100,display:"table-cell",duration:100})})}}}),e.directive("createTodo",function(){return{restrict:"A",scope:!1,link:function(t,e,n){e.bind("keydown",function(t){var e=t.which;13===e&&($("#todo-button").click(),$("#create-todo").val(""))})}}}),e.directive("todoButton",function(){return{restrict:"A",scope:!1,link:function(t,e,i){e.bind("click",function(e){t.$apply(function(){t.newTodo&&(t.create(t.newTodo),n(),t.newTodo="")})})}}}),e.directive("inputKey",function(){return{restrict:"A",scope:!1,link:function(t,e,n){e.bind("keydown",function(t){var e=t.which;13===e&&$("#key-button").click()})}}}),e.directive("keyButton",function(){return{restrict:"A",scope:!1,link:function(t,e,n){e.bind("click",function(e){var n=t.user.key;t.lookup(n),t.$apply(function(){{var t=$("#key-modal"),e=$("#mask");t.width(),t.height(),$(window).width()}n&&(e.addClass("inactive-mask"),t.removeClass("active-modal").addClass("inactive-modal"),setTimeout(function(){t.remove(),e.remove()},750)),$("#create-todo").focus()})})}}}),e.directive("deleteButton",function(){return{restrict:"A",scope:!1,link:function(e,n,o){n.bind("click",function(o){e.$apply(function(){var o=n.parents(".todo");o.hasClass("deleting")?(clearTimeout(t),n.removeClass("fa-undo").addClass("fa-trash-o"),o.removeClass("deleting")):(n.removeClass("fa-trash-o").addClass("fa-undo"),o.addClass("deleting"),t=setTimeout(function(){var t=i(e,n);e["delete"](t),e.$apply()},5e3))})})}}})}();
function windowWidth(){return $(window).width()}function windowHeight(){return $(window).height()}function keyModal(){{var t=(windowWidth(),windowHeight(),$("#key-modal"));$("#mask"),t.width(),t.height()}$("#tips-button").click(function(){$("#tips-button").hasClass("toggled")?$(".fine-print").velocity("slideUp",{duration:250,complete:function(){$("#tips-button").removeClass("toggled")}}):$(".fine-print").velocity("slideDown",{duration:250,complete:function(){$("#tips-button").addClass("toggled")}})}),$("#key").focus()}function renameItem(){$("table tbody").on("dblclick",".name",function(){$(this).hide(),$(this).siblings(".rename").show().select()}),$("table tbody").on("click",".fa-pencil",function(){var t=$(this).parents("tr").find("span.name"),n=$(this).parents("tr").find(".rename");t.hide(),n.show().select()});var t=function(t){$(".rename").val()&&(t.siblings(".name").show(),t.hide())};$("table tbody").on({keydown:function(n){var o=n.which;13===o&&t($(this))},blur:function(){t($(this))}},".rename")}function saveButton(){var t={91:!1,40:!1};$(document).keydown(function(n){n.which in t&&(t[n.which]=!0,t[91]&&t[40]&&$("#save-button.toggled").click())}).keyup(function(n){n.which in t&&(t[n.which]=!1)})}function todoHover(){tap||($("table tbody").on("mouseenter",'tr:not(".complete"):not(".deleting")',function(){$(this).velocity({backgroundColor:"#00B0FF",backgroundColorAlpha:1},{duration:0})}),$("table tbody").on("mouseleave","tr",function(){$(this).velocity({backgroundColorAlpha:0},{duration:500})}))}var userKey,tap="ontouchstart"in document.documentElement;$(keyModal),$(renameItem),$(saveButton),$(todoHover);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImNvbnRyb2xsZXJzLmpzIiwiZGlyZWN0aXZlcy5qcyIsIndvcmtpbmctZmlsZS5qcyJdLCJuYW1lcyI6WyJhbmd1bGFyIiwibW9kdWxlIiwiYXBwIiwiY29udHJvbGxlciIsIiRodHRwIiwiJHNjb3BlIiwiJGxvZyIsIm5ld1RvZG8iLCJ1c2VyIiwidG9kb3MiLCJkYXJrbW9kZSIsInNhdmVCdXR0b24iLCJzb3J0YWJsZU9wdGlvbnMiLCJoYW5kbGUiLCJzb3J0IiwiYW5pbWF0aW9uIiwiZ2hvc3RDbGFzcyIsInNjcm9sbCIsInNjcm9sbFNlbnNpdGl2aXR5Iiwic2Nyb2xsU3BlZWQiLCJjb3VudGVyIiwibG9va3VwIiwia2V5IiwicG9zdCIsInN1Y2Nlc3MiLCJkYXRhIiwiaGFzT3duUHJvcGVydHkiLCJsb2ciLCJlcnJvciIsImNyZWF0ZSIsIml0ZW0iLCJ1bnNoaWZ0IiwiY29tcGxldGUiLCJ3cml0ZSIsIm5vdyIsIkRhdGUiLCJkYXRlTW9kaWZpZWQiLCJ0b0lTT1N0cmluZyIsImpzb24iLCJ0b0pzb24iLCJpbmRleCIsInNwbGljZSIsIiR3YXRjaCIsIm5ld1ZhbHVlIiwib2xkVmFsdWUiLCJjb25zb2xlIiwidGltZW91dElEIiwibW9iaWxlQnV0dG9ucyIsIndpZHRoIiwiJCIsIndpbmRvdyIsInZlbG9jaXR5IiwiZHVyYXRpb24iLCJkZWxheSIsImRpc3BsYXkiLCJnZXRJbmRleCIsInNjb3BlIiwiZWxlbWVudCIsInBhcmVudHMiLCJpdGVtVmFsIiwiZmluZCIsInRleHQiLCJfIiwiZWFjaCIsInZhbCIsImkiLCJkaXJlY3RpdmUiLCJyZXN0cmljdCIsImxpbmsiLCJhdHRycyIsImJpbmQiLCIkYXBwbHkiLCJvbGRJbmRleCIsIm5ld0luZGV4IiwibGVuZ3RoIiwic3BsaWNlZFRvZG8iLCJhdHRyIiwicmVtb3ZlQ2xhc3MiLCJzaWJsaW5ncyIsImNsaWNrIiwiZSIsIndoaWNoIiwidXNlcktleSIsIm1vZGFsIiwibWFzayIsImhlaWdodCIsImFkZENsYXNzIiwic2V0VGltZW91dCIsInJlbW92ZSIsImZvY3VzIiwidG9kbyIsImhhc0NsYXNzIiwiY2xlYXJUaW1lb3V0Iiwid2luZG93V2lkdGgiLCJ3aW5kb3dIZWlnaHQiLCJrZXlNb2RhbCIsInJlbmFtZUl0ZW0iLCJvbiIsInRoaXMiLCJoaWRlIiwic2hvdyIsInNlbGVjdCIsInJlbmFtZSIsInJlbmFtZUhhbmRsZXIiLCJlbCIsImtleWRvd24iLCJibHVyIiwibWFwIiw5MSw0MCwiZG9jdW1lbnQiLCJrZXl1cCIsInRvZG9Ib3ZlciIsInRhcCIsImJhY2tncm91bmRDb2xvciIsImJhY2tncm91bmRDb2xvckFscGhhIiwiZG9jdW1lbnRFbGVtZW50Il0sIm1hcHBpbmdzIjoiQ0FBQSxXQUNDLFlBR1VBLFNBQVFDLE9BQU8sZ0JBQ3hCLFVBQ0EsWUFDQSxjQUNBLHVCQUNBO0NDVEYsV0FDQyxZQUdBLElBQUlDLEdBQU1GLFFBQVFDLE9BQU8sMEJBRXpCQyxHQUFJQyxXQUFXLGtCQUFtQixRQUFTLFNBQVUsT0FDcEQsU0FBVUMsRUFBT0MsRUFBUUMsR0FDeEJELEVBQU9FLFFBQVUsR0FDakJGLEVBQU9HLFFBQ1BILEVBQU9HLEtBQUtDLE1BQVEsS0FDcEJKLEVBQU9HLEtBQUtFLFNBQVcsS0FDdkJMLEVBQU9NLFlBQWEsRUFDcEJOLEVBQU9PLGlCQUNOQyxPQUFRLFFBQ1JDLE1BQU0sRUFDTkMsVUFBVyxJQUNYQyxXQUFZLFFBQ1pDLFFBQVEsRUFDUkMsa0JBQW1CLEdBQ2pCQyxZQUFhLEdBRWhCLElBQUlDLEdBQVUsQ0FDZGYsR0FBT2dCLE9BQVMsU0FBVUMsR0FDekJsQixFQUFNbUIsS0FBSyxnQkFDVEQsSUFBS0EsSUFFTEUsUUFBUSxTQUFVQyxHQUNsQnBCLEVBQU9HLEtBQUtDLE1BQVNnQixFQUFVLE1BQUlBLEVBQUtoQixTQUNwQ2dCLEVBQUtDLGVBQWUsU0FBUXJCLEVBQU9HLEtBQUtjLElBQU1HLEVBQUtILEtBQ3ZEakIsRUFBT0csS0FBS0UsU0FBWWUsRUFBS0MsZUFB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QVMsRUFDWDBCLEVBQUksS0FBT0EsRUFBSSxLQUNsQjFELEVBQUUsd0JBQXdCOEIsV0FHMUJnQyxNQUFNLFNBQVUvQixHQUNkQSxFQUFFQyxRQUFTMEIsS0FDZEEsRUFBSTNCLEVBQUVDLFFBQVMsS0FLbEIsUUFBUytCLGFBQ0hDLE1BQ0poRSxFQUFFLGVBQWVnRCxHQUFHLGFBQWMsdUNBQXdDLFdBQ3pFaEQsRUFBRWlELE1BQU0vQyxVQUNQK0QsZ0JBQWlCLFVBQ2pCQyxxQkFBc0IsSUFFdEIvRCxTQUFVLE1BSVpILEVBQUUsZUFBZWdELEdBQUcsYUFBYyxLQUFNLFdBQ3ZDaEQsRUFBRWlELE1BQU0vQyxVQUNQZ0UscUJBQXNCLElBRXRCL0QsU0FBVSxTQS9HZCxHQUFJOEIsU0FDQStCLElBQU8sZ0JBQWtCSCxVQUFTTSxlQW9IdENuRSxHQUFFOEMsVUFDRjlDLEVBQUUrQyxZQUNGL0MsRUFBRXRDLFlBQ0ZzQyxFQUFFK0QiLCJmaWxlIjoic2NyaXB0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uICgpIHtcblx0J3VzZSBzdHJpY3QnO1xuXHQvKiBBcHAgTW9kdWxlICovXG5cdFxuXHR2YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ3Rhc2ttYXN0ckFwcCcsIFtcblx0XHQnbmdUb3VjaCcsXG5cdFx0J25nQW5pbWF0ZScsXG5cdFx0J25nLXNvcnRhYmxlJyxcblx0XHQndGFza21hc3RyQ29udHJvbGxlcnMnLFxuXHRcdCd0YXNrbWFzdHJEaXJlY3RpdmVzJ1xuXHRdKTtcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcblx0J3VzZSBzdHJpY3QnO1xuXHQvKiBDb250cm9sbGVycyAqL1xuXG5cdHZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgndGFza21hc3RyQ29udHJvbGxlcnMnLCBbXSk7XG5cblx0YXBwLmNvbnRyb2xsZXIoJ1VzZXJDb250cm9sbGVyJywgWyckaHR0cCcsICckc2NvcGUnLCAnJGxvZycsXG5cdFx0ZnVuY3Rpb24gKCRodHRwLCAkc2NvcGUsICRsb2cpIHtcblx0XHRcdCRzY29wZS5uZXdUb2RvID0gJyc7XG5cdFx0XHQkc2NvcGUudXNlciA9IHt9O1xuXHRcdFx0JHNjb3BlLnVzZXIudG9kb3MgPSBudWxsO1xuXHRcdFx0JHNjb3BlLnVzZXIuZGFya21vZGUgPSBudWxsO1xuXHRcdFx0JHNjb3BlLnNhdmVCdXR0b24gPSBmYWxzZTtcblx0XHRcdCRzY29wZS5zb3J0YWJsZU9wdGlvbnMgPSB7XG5cdFx0XHRcdGhhbmRsZTogJy5zb3J0Jyxcblx0XHRcdFx0c29ydDogdHJ1ZSxcblx0XHRcdFx0YW5pbWF0aW9uOiAxNTAsXG5cdFx0XHRcdGdob3N0Q2xhc3M6ICdnaG9zdCcsXG5cdFx0XHRcdHNjcm9sbDogdHJ1ZSxcblx0XHRcdFx0c2Nyb2xsU2Vuc2l0aXZpdHk6IDMwLFxuICAgIFx0XHRzY3JvbGxTcGVlZDogMTBcblx0XHRcdH07XG5cdFx0XHR2YXIgY291bnRlciA9IDA7XG5cdFx0XHQkc2NvcGUubG9va3VwID0gZnVuY3Rpb24gKGtleSkge1xuXHRcdFx0XHQkaHR0cC5wb3N0KCcvdXNlcnMvbG9naW4nLCB7XG5cdFx0XHRcdFx0XHRrZXk6IGtleVxuXHRcdFx0XHRcdH0pXG5cdFx0XHRcdFx0LnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcblx0XHRcdFx0XHRcdCRzY29wZS51c2VyLnRvZG9zID0gKGRhdGEudG9kb3MpID8gZGF0YS50b2RvcyA6IFtdO1xuXHRcdFx0XHRcdFx0aWYgKGRhdGEuaGFzT3duUHJvcGVydHkoJ2tleScpKSAkc2NvcGUudXNlci5rZXkgPSBkYXRhLmtleTtcblx0XHRcdFx0XHRcdCRzY29wZS51c2VyLmRhcmttb2RlID0gKGRhdGEuaGFzT3duUHJvcGVydHkoJ2Rhcmttb2RlJykpID8gZGF0YS5kYXJrbW9kZSA6IGZhbHNlO1xuXHRcdFx0XHRcdFx0JGxvZy5sb2coJ1VzZXIgcHJvZmlsZSBtb3VudGVkLi4uJyk7XG5cdFx0XHRcdFx0XHQkbG9nLmxvZygkc2NvcGUudXNlcik7XG5cdFx0XHRcdFx0fSlcblx0XHRcdFx0XHQuZXJyb3IoZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdFx0JGxvZy5sb2coJ0Vycm9yIGNvbm5lY3RpbmcgdG8gZGIhJyk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHR9O1xuXHRcdFx0JHNjb3BlLmNyZWF0ZSA9IGZ1bmN0aW9uIChpdGVtKSB7XG5cdFx0XHRcdCRzY29wZS51c2VyLnRvZG9zLnVuc2hpZnQoe1xuXHRcdFx0XHRcdGl0ZW06IGl0ZW0sXG5cdFx0XHRcdFx0Y29tcGxldGU6IGZhbHNlXG5cdFx0XHRcdH0pO1xuXHRcdFx0XHQkbG9nLmxvZygnQ3JlYXRpbmcgdG9kby4uLiBPSycpO1xuXHRcdFx0fTtcblx0XHRcdCRzY29wZS53cml0ZSA9IGZ1bmN0aW9uIChrZXkpIHtcblx0XHRcdFx0dmFyIG5vdyA9IG5ldyBEYXRlKCk7XG5cdFx0XHRcdCRzY29wZS51c2VyLmRhdGVNb2RpZmllZCA9IG5vdy50b0lTT1N0cmluZygpO1xuXHRcdFx0XHQkbG9nLmxvZygnU2F2aW5nIHRvIGRiLi4uJylcblx0XHRcdFx0JGxvZy5sb2coJHNjb3BlLnVzZXIpO1xuXHRcdFx0XHQkc2NvcGUuc2F2ZUJ1dHRvbiA9IGZhbHNlO1xuXHRcdFx0XHQkbG9nLmxvZygnc2F2ZUJ1dHRvbiA9ICcgKyAkc2NvcGUuc2F2ZUJ1dHRvbik7XG5cdFx0XHRcdCRodHRwLnBvc3QoJy91c2Vycy93cml0ZScsIHtcblx0XHRcdFx0XHRcdGpzb246IGFuZ3VsYXIudG9Kc29uKCRzY29wZS51c2VyKVxuXHRcdFx0XHRcdH0pXG5cdFx0XHRcdFx0LnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcblx0XHRcdFx0XHRcdCRsb2cubG9nKCdXcml0aW5nIGRhdGEuLi4gT0snKTtcblx0XHRcdFx0XHR9KVxuXHRcdFx0XHRcdC5lcnJvcihmdW5jdGlvbiAoZGF0YSkge1xuXHRcdFx0XHRcdFx0JGxvZy5sb2coJ0Vycm9yIHdyaXRpbmcgZGF0YSEnKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdH07XG5cdFx0XHQkc2NvcGUuZGVsZXRlID0gZnVuY3Rpb24oaW5kZXgpIHtcblx0XHRcdFx0JHNjb3BlLnVzZXIudG9kb3Muc3BsaWNlKGluZGV4LCAxKTtcblx0XHRcdH07XG5cdFx0XHQkc2NvcGUuJHdhdGNoKCd1c2VyLnRvZG9zJywgZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xuXHRcdFx0XHRpZiAobmV3VmFsdWUgPT09IG9sZFZhbHVlKSByZXR1cm47XG5cdFx0XHRcdGlmIChjb3VudGVyID49IDIpICRzY29wZS5zYXZlQnV0dG9uID0gdHJ1ZTtcblx0XHRcdFx0JGxvZy5sb2coJ3NhdmVCdXR0b24gPSAnICsgJHNjb3BlLnNhdmVCdXR0b24pO1xuXHRcdFx0XHRjb3VudGVyICs9IDE7XG5cdFx0XHRcdGNvbnNvbGUubG9nKCd0b2RvIGNvdW50ZXIgPSAnICsgY291bnRlcik7XG5cdFx0XHR9LCB0cnVlKTtcblx0XHRcdCRzY29wZS4kd2F0Y2goJ3VzZXIuZGFya21vZGUnLCBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7XG5cdFx0XHRcdGlmIChuZXdWYWx1ZSA9PT0gb2xkVmFsdWUpIHJldHVybjtcblx0XHRcdFx0aWYgKGNvdW50ZXIgPj0gMikgJHNjb3BlLnNhdmVCdXR0b24gPSB0cnVlO1xuXHRcdFx0XHQkbG9nLmxvZygnc2F2ZUJ1dHRvbiA9ICcgKyAkc2NvcGUuc2F2ZUJ1dHRvbik7XG5cdFx0XHRcdGNvdW50ZXIgKz0gMTtcblx0XHRcdFx0Y29uc29sZS5sb2coJ2Rhcmttb2RlIGNvdW50ZXIgPSAnICsgY291bnRlcik7XG5cdFx0XHR9LCB0cnVlKTtcblx0XHR9XG5cdF0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG5cdHZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgndGFza21hc3RyRGlyZWN0aXZlcycsIFtdKTtcblxuXHR2YXIgbW9iaWxlQnV0dG9ucyA9IGZ1bmN0aW9uICgpIHtcblx0XHR2YXIgd2lkdGggPSAkKHdpbmRvdykud2lkdGgoKTtcblx0XHRpZiAod2lkdGggPCA3NjgpIHtcblx0XHRcdCQoJ3RhYmxlIHRib2R5IHRkLnV0aWxzJykudmVsb2NpdHkoJ2ZhZGVPdXQnLCB7XG5cdFx0XHRcdGR1cmF0aW9uOiAxMDBcblx0XHRcdH0pO1xuXHRcdFx0JCgndGFibGUgdGJvZHkgdGQudG9nZ2xlJykudmVsb2NpdHkoJ2ZhZGVJbicsIHtcblx0XHRcdFx0ZGVsYXk6IDEwMCxcblx0XHRcdFx0ZGlzcGxheTogJ3RhYmxlLWNlbGwnLFxuXHRcdFx0XHRkdXJhdGlvbjogMTAwXG5cdFx0XHR9KTtcblx0XHR9XG5cdH1cblx0dmFyIGdldEluZGV4ID0gZnVuY3Rpb24gKHNjb3BlLCBlbGVtZW50KSB7XG5cdFx0dmFyIGl0ZW0gPSBlbGVtZW50LnBhcmVudHMoJy50b2RvJyk7XG5cdFx0dmFyIGl0ZW1WYWwgPSBpdGVtLmZpbmQoJ3RkLnRvZG8tY2VsbCBzcGFuJykudGV4dCgpO1xuXHRcdHZhciB0b2RvcyA9IHNjb3BlLnVzZXIudG9kb3M7XG5cdFx0dmFyIGluZGV4O1xuXHRcdF8uZWFjaCh0b2RvcywgZnVuY3Rpb24gKHZhbCwgaSkge1xuXHRcdFx0aWYgKHZhbC5pdGVtID09PSBpdGVtVmFsKSB7XG5cdFx0XHRcdGluZGV4ID0gaTtcblx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHRcdHJldHVybiBpbmRleDtcblx0fVxuXHR2YXIgdGltZW91dElEO1xuXG5cdGFwcC5kaXJlY3RpdmUoJ2NvbXBsZXRlJywgZnVuY3Rpb24gKCkge1xuXHRcdHJldHVybiB7XG5cdFx0XHRyZXN0cmljdDogXCJBXCIsXG5cdFx0XHRzY29wZTogZmFsc2UsXG5cdFx0XHRsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XG5cdFx0XHRcdGVsZW1lbnQuYmluZCgnY2xpY2snLCBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0c2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRcdHZhciB0b2RvcyA9IHNjb3BlLnVzZXIudG9kb3M7XG5cdFx0XHRcdFx0XHR2YXIgb2xkSW5kZXggPSBnZXRJbmRleChzY29wZSwgZWxlbWVudCk7XG5cdFx0XHRcdFx0XHR2YXIgbmV3SW5kZXggPSB0b2Rvcy5sZW5ndGg7XG5cdFx0XHRcdFx0XHR2YXIgc3BsaWNlZFRvZG8gPSB0b2Rvcy5zcGxpY2Uob2xkSW5kZXgsIDEpO1xuXHRcdFx0XHRcdFx0Xy5lYWNoKHRvZG9zLCBmdW5jdGlvbiAodmFsLCBpKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh2YWwuY29tcGxldGUgPT09IHRydWUpIHtcblx0XHRcdFx0XHRcdFx0XHRuZXdJbmRleCA9IGk7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdHRvZG9zLnNwbGljZShuZXdJbmRleCwgMCwgc3BsaWNlZFRvZG9bMF0pO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9O1xuXHR9KTtcblx0YXBwLmRpcmVjdGl2ZSgnc2F2ZScsIGZ1bmN0aW9uICgpIHtcblx0XHRyZXR1cm4ge1xuXHRcdFx0cmVzdHJpY3Q6ICdBJyxcblx0XHRcdHNjb3BlOiBmYWxzZSxcblx0XHRcdGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxlbWVudCwgYXR0cikge1xuXHRcdFx0XHRlbGVtZW50LmJpbmQoJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdHNjb3BlLndyaXRlKHNjb3BlLnVzZXIua2V5KTtcblx0XHRcdFx0XHRtb2JpbGVCdXR0b25zKCk7XG5cdFx0XHRcdFx0ZWxlbWVudC5yZW1vdmVDbGFzcygndG9nZ2xlZCcpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9XG5cdH0pO1xuXHRhcHAuZGlyZWN0aXZlKCdjaGVja0J1dHRvbicsIGZ1bmN0aW9uICgpIHtcblx0XHRyZXR1cm4ge1xuXHRcdFx0cmVzdHJpY3Q6ICdBJyxcblx0XHRcdHNjb3BlOiBmYWxzZSxcblx0XHRcdGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxlbWVudCwgYXR0cikge1xuXHRcdFx0XHRlbGVtZW50LmJpbmQoJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdGVsZW1lbnQuc2libGluZ3MoJy5jaGVjaycpLmNsaWNrKCk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH1cblx0fSk7XG5cdGFwcC5kaXJlY3RpdmUoJ21vYmlsZUJ1dHRvbicsIGZ1bmN0aW9uICgpIHtcblx0XHRyZXR1cm4ge1xuXHRcdFx0cmVzdHJpY3Q6ICdBJyxcblx0XHRcdHNjb3BlOiBmYWxzZSxcblx0XHRcdGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxlbWVudCwgYXR0cikge1xuXHRcdFx0XHRlbGVtZW50LmJpbmQoJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdCQoJ3RhYmxlIHRib2R5IHRkLnRvZ2dsZScpLnZlbG9jaXR5KCdmYWRlT3V0Jywge1xuXHRcdFx0XHRcdFx0ZHVyYXRpb246IDEwMFxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdCQoJ3RhYmxlIHRib2R5IHRkLnV0aWxzJykudmVsb2NpdHkoJ2ZhZGVJbicsIHtcblx0XHRcdFx0XHRcdGRlbGF5OiAxMDAsXG5cdFx0XHRcdFx0XHRkaXNwbGF5OiAndGFibGUtY2VsbCcsXG5cdFx0XHRcdFx0XHRkdXJhdGlvbjogMTAwXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH1cblx0fSk7XG5cdGFwcC5kaXJlY3RpdmUoJ2NyZWF0ZVRvZG8nLCBmdW5jdGlvbiAoKSB7XG5cdFx0cmV0dXJuIHtcblx0XHRcdHJlc3RyaWN0OiAnQScsXG5cdFx0XHRzY29wZTogZmFsc2UsXG5cdFx0XHRsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsZW1lbnQsIGF0dHIpIHtcblx0XHRcdFx0ZWxlbWVudC5iaW5kKCdrZXlkb3duJywgZnVuY3Rpb24gKGUpIHtcblx0XHRcdFx0XHR2YXIga2V5ID0gZS53aGljaDtcblx0XHRcdFx0XHRpZiAoa2V5ID09PSAxMykge1xuXHRcdFx0XHRcdFx0JCgnI3RvZG8tYnV0dG9uJykuY2xpY2soKTtcblx0XHRcdFx0XHRcdCQoJyNjcmVhdGUtdG9kbycpLnZhbCgnJyk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9XG5cdH0pO1xuXHRhcHAuZGlyZWN0aXZlKCd0b2RvQnV0dG9uJywgZnVuY3Rpb24gKCkge1xuXHRcdHJldHVybiB7XG5cdFx0XHRyZXN0cmljdDogJ0EnLFxuXHRcdFx0c2NvcGU6IGZhbHNlLFxuXHRcdFx0bGluazogZnVuY3Rpb24gKHNjb3BlLCBlbGVtZW50LCBhdHRyKSB7XG5cdFx0XHRcdGVsZW1lbnQuYmluZCgnY2xpY2snLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHRcdHNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0XHRpZiAoc2NvcGUubmV3VG9kbykge1xuXHRcdFx0XHRcdFx0XHRzY29wZS5jcmVhdGUoc2NvcGUubmV3VG9kbyk7XG5cdFx0XHRcdFx0XHRcdG1vYmlsZUJ1dHRvbnMoKTtcblx0XHRcdFx0XHRcdFx0c2NvcGUubmV3VG9kbyA9ICcnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9XG5cdH0pO1xuXHRhcHAuZGlyZWN0aXZlKCdpbnB1dEtleScsIGZ1bmN0aW9uICgpIHtcblx0XHRyZXR1cm4ge1xuXHRcdFx0cmVzdHJpY3Q6ICdBJyxcblx0XHRcdHNjb3BlOiBmYWxzZSxcblx0XHRcdGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxlbWVudCwgYXR0cikge1xuXHRcdFx0XHRlbGVtZW50LmJpbmQoJ2tleWRvd24nLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHRcdHZhciBrZXkgPSBlLndoaWNoO1xuXHRcdFx0XHRcdGlmIChrZXkgPT09IDEzKSB7XG5cdFx0XHRcdFx0XHQkKCcja2V5LWJ1dHRvbicpLmNsaWNrKCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9XG5cdH0pO1xuXHRhcHAuZGlyZWN0aXZlKCdrZXlCdXR0b24nLCBmdW5jdGlvbiAoKSB7XG5cdFx0cmV0dXJuIHtcblx0XHRcdHJlc3RyaWN0OiAnQScsXG5cdFx0XHRzY29wZTogZmFsc2UsXG5cdFx0XHRsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsZW1lbnQsIGF0dHIpIHtcblx0XHRcdFx0ZWxlbWVudC5iaW5kKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdFx0dmFyIHVzZXJLZXkgPSBzY29wZS51c2VyLmtleTtcblx0XHRcdFx0XHRzY29wZS5sb29rdXAodXNlcktleSk7XG5cdFx0XHRcdFx0c2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRcdHZhciBtb2RhbCA9ICQoJyNrZXktbW9kYWwnKTtcblx0XHRcdFx0XHRcdHZhciBtYXNrID0gJCgnI21hc2snKTtcblx0XHRcdFx0XHRcdHZhciBtb2RhbFdpZHRoID0gbW9kYWwud2lkdGgoKTtcblx0XHRcdFx0XHRcdHZhciBtb2RhbEhlaWdodCA9IG1vZGFsLmhlaWdodCgpO1xuXHRcdFx0XHRcdFx0dmFyIHdpZHRoID0gJCh3aW5kb3cpLndpZHRoKCk7XG5cdFx0XHRcdFx0XHRpZiAodXNlcktleSkge1xuXHRcdFx0XHRcdFx0XHRtYXNrLmFkZENsYXNzKCdpbmFjdGl2ZS1tYXNrJyk7XG5cdFx0XHRcdFx0XHRcdG1vZGFsLnJlbW92ZUNsYXNzKCdhY3RpdmUtbW9kYWwnKS5hZGRDbGFzcygnaW5hY3RpdmUtbW9kYWwnKTtcblx0XHRcdFx0XHRcdFx0c2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0XHRcdFx0bW9kYWwucmVtb3ZlKCk7XG5cdFx0XHRcdFx0XHRcdFx0bWFzay5yZW1vdmUoKTtcblx0XHRcdFx0XHRcdFx0fSwgNzUwKTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0JCgnI2NyZWF0ZS10b2RvJykuZm9jdXMoKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9KTtcblx0YXBwLmRpcmVjdGl2ZSgnZGVsZXRlQnV0dG9uJywgZnVuY3Rpb24gKCkge1xuXHRcdHJldHVybiB7XG5cdFx0XHRyZXN0cmljdDogJ0EnLFxuXHRcdFx0c2NvcGU6IGZhbHNlLFxuXHRcdFx0bGluazogZnVuY3Rpb24gKHNjb3BlLCBlbGVtZW50LCBhdHRyKSB7XG5cdFx0XHRcdGVsZW1lbnQuYmluZCgnY2xpY2snLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHRcdHNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0XHR2YXIgdG9kbyA9IGVsZW1lbnQucGFyZW50cygnLnRvZG8nKTtcblx0XHRcdFx0XHRcdGlmICghdG9kby5oYXNDbGFzcygnZGVsZXRpbmcnKSkge1xuXHRcdFx0XHRcdFx0XHRlbGVtZW50LnJlbW92ZUNsYXNzKCdmYS10cmFzaC1vJykuYWRkQ2xhc3MoJ2ZhLXVuZG8nKTtcblx0XHRcdFx0XHRcdFx0dG9kby5hZGRDbGFzcygnZGVsZXRpbmcnKTtcblx0XHRcdFx0XHRcdFx0dGltZW91dElEID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0XHRcdFx0dmFyIGluZGV4ID0gZ2V0SW5kZXgoc2NvcGUsIGVsZW1lbnQpO1xuXHRcdFx0XHRcdFx0XHRcdHNjb3BlLmRlbGV0ZShpbmRleCk7XG5cdFx0XHRcdFx0XHRcdFx0c2NvcGUuJGFwcGx5KCk7XG5cdFx0XHRcdFx0XHRcdH0sIDUwMDApO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0Y2xlYXJUaW1lb3V0KHRpbWVvdXRJRCk7XG5cdFx0XHRcdFx0XHRcdGVsZW1lbnQucmVtb3ZlQ2xhc3MoJ2ZhLXVuZG8nKS5hZGRDbGFzcygnZmEtdHJhc2gtbycpO1xuXHRcdFx0XHRcdFx0XHR0b2RvLnJlbW92ZUNsYXNzKCdkZWxldGluZycpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9XG5cdH0pO1xufSkoKTtcbiIsInZhciB1c2VyS2V5O1xudmFyIHRhcCA9IChcIm9udG91Y2hzdGFydFwiIGluIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCk7XG5cbmZ1bmN0aW9uIHdpbmRvd1dpZHRoKCkge1xuXHRyZXR1cm4gJCh3aW5kb3cpLndpZHRoKCk7XG59XG5cbmZ1bmN0aW9uIHdpbmRvd0hlaWdodCgpIHtcblx0cmV0dXJuICQod2luZG93KS5oZWlnaHQoKTtcbn1cblxuZnVuY3Rpb24ga2V5TW9kYWwoKSB7XG5cdHZhciB3aWR0aCA9IHdpbmRvd1dpZHRoKCk7XG5cdHZhciBoZWlnaHQgPSB3aW5kb3dIZWlnaHQoKTtcblx0dmFyIG1vZGFsID0gJCgnI2tleS1tb2RhbCcpO1xuXHR2YXIgbWFzayA9ICQoJyNtYXNrJyk7XG5cdHZhciBtb2RhbFdpZHRoID0gbW9kYWwud2lkdGgoKTtcblx0dmFyIG1vZGFsSGVpZ2h0ID0gbW9kYWwuaGVpZ2h0KCk7XG5cblx0JCgnI3RpcHMtYnV0dG9uJykuY2xpY2soZnVuY3Rpb24gKCkge1xuXHRcdGlmICgkKCcjdGlwcy1idXR0b24nKS5oYXNDbGFzcygndG9nZ2xlZCcpKSB7XG5cdFx0XHQkKCcuZmluZS1wcmludCcpLnZlbG9jaXR5KCdzbGlkZVVwJywge1xuXHRcdFx0XHRkdXJhdGlvbjogMjUwLFxuXHRcdFx0XHRjb21wbGV0ZTogZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdCQoJyN0aXBzLWJ1dHRvbicpLnJlbW92ZUNsYXNzKCd0b2dnbGVkJyk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHQkKCcuZmluZS1wcmludCcpLnZlbG9jaXR5KCdzbGlkZURvd24nLCB7XG5cdFx0XHRcdGR1cmF0aW9uOiAyNTAsXG5cdFx0XHRcdGNvbXBsZXRlOiBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0JCgnI3RpcHMtYnV0dG9uJykuYWRkQ2xhc3MoJ3RvZ2dsZWQnKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fVxuXHR9KTtcblxuXHQkKCcja2V5JykuZm9jdXMoKTtcbn1cblxuZnVuY3Rpb24gcmVuYW1lSXRlbSgpIHtcblx0JCgndGFibGUgdGJvZHknKS5vbignZGJsY2xpY2snLCAnLm5hbWUnLCBmdW5jdGlvbiAoKSB7XG5cdFx0JCh0aGlzKS5oaWRlKCk7XG5cdFx0JCh0aGlzKS5zaWJsaW5ncygnLnJlbmFtZScpLnNob3coKS5zZWxlY3QoKTtcblx0fSk7XG5cblx0JCgndGFibGUgdGJvZHknKS5vbignY2xpY2snLCAnLmZhLXBlbmNpbCcsIGZ1bmN0aW9uICgpIHtcblx0XHR2YXIgdGV4dCA9ICQodGhpcykucGFyZW50cygndHInKS5maW5kKCdzcGFuLm5hbWUnKTtcblx0XHR2YXIgcmVuYW1lID0gJCh0aGlzKS5wYXJlbnRzKCd0cicpLmZpbmQoJy5yZW5hbWUnKTtcblx0XHR0ZXh0LmhpZGUoKTtcblx0XHRyZW5hbWUuc2hvdygpLnNlbGVjdCgpO1xuXHR9KTtcblxuXHR2YXIgcmVuYW1lSGFuZGxlciA9IGZ1bmN0aW9uIChlbCkge1xuXHRcdGlmICgkKCcucmVuYW1lJykudmFsKCkpIHtcblx0XHRcdGVsLnNpYmxpbmdzKCcubmFtZScpLnNob3coKTtcblx0XHRcdGVsLmhpZGUoKTtcblx0XHR9XG5cdH1cblxuXHQkKCd0YWJsZSB0Ym9keScpLm9uKHtcblx0XHRcdGtleWRvd246IGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdHZhciBrZXkgPSBlLndoaWNoO1xuXHRcdFx0XHRpZiAoa2V5ID09PSAxMykge1xuXHRcdFx0XHRcdHJlbmFtZUhhbmRsZXIoJCh0aGlzKSk7XG5cdFx0XHRcdH1cblx0XHRcdH0sXG5cdFx0XHRibHVyOiBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdHJlbmFtZUhhbmRsZXIoJCh0aGlzKSk7XG5cdFx0XHR9XG5cdFx0fSxcblx0XHQnLnJlbmFtZSdcblx0KTtcbn1cblxuZnVuY3Rpb24gc2F2ZUJ1dHRvbigpIHtcblxuXHR2YXIgbWFwID0ge1xuXHRcdDkxOiBmYWxzZSxcblx0XHQ0MDogZmFsc2Vcblx0fTtcblxuXHQkKGRvY3VtZW50KS5rZXlkb3duKGZ1bmN0aW9uIChlKSB7XG5cdFx0aWYgKGUud2hpY2ggaW4gbWFwKSB7XG5cdFx0XHRtYXBbZS53aGljaF0gPSB0cnVlO1xuXHRcdFx0aWYgKG1hcFs5MV0gJiYgbWFwWzQwXSkge1xuXHRcdFx0XHQkKCcjc2F2ZS1idXR0b24udG9nZ2xlZCcpLmNsaWNrKCk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9KS5rZXl1cChmdW5jdGlvbiAoZSkge1xuXHRcdGlmIChlLndoaWNoIGluIG1hcCkge1xuXHRcdFx0bWFwW2Uud2hpY2hdID0gZmFsc2U7XG5cdFx0fVxuXHR9KTtcbn1cblxuZnVuY3Rpb24gdG9kb0hvdmVyKCkge1xuXHRpZiAoIXRhcCkge1xuXHRcdCQoJ3RhYmxlIHRib2R5Jykub24oJ21vdXNlZW50ZXInLCAndHI6bm90KFwiLmNvbXBsZXRlXCIpOm5vdChcIi5kZWxldGluZ1wiKScsIGZ1bmN0aW9uICgpIHtcblx0XHRcdCQodGhpcykudmVsb2NpdHkoe1xuXHRcdFx0XHRiYWNrZ3JvdW5kQ29sb3I6ICcjMDBCMEZGJyxcblx0XHRcdFx0YmFja2dyb3VuZENvbG9yQWxwaGE6IDFcblx0XHRcdH0sIHtcblx0XHRcdFx0ZHVyYXRpb246IDBcblx0XHRcdH0pO1xuXHRcdH0pO1xuXG5cdFx0JCgndGFibGUgdGJvZHknKS5vbignbW91c2VsZWF2ZScsICd0cicsIGZ1bmN0aW9uICgpIHtcblx0XHRcdCQodGhpcykudmVsb2NpdHkoe1xuXHRcdFx0XHRiYWNrZ3JvdW5kQ29sb3JBbHBoYTogMFxuXHRcdFx0fSwge1xuXHRcdFx0XHRkdXJhdGlvbjogNTAwXG5cdFx0XHR9KTtcblx0XHR9KTtcblx0fVxufVxuXG4kKGtleU1vZGFsKTtcbiQocmVuYW1lSXRlbSk7XG4kKHNhdmVCdXR0b24pO1xuJCh0b2RvSG92ZXIpO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
